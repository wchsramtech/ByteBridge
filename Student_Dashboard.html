// ================================
// Dark Mode Toggle
// ================================
const themeToggle = document.getElementById("theme-toggle");
themeToggle?.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");
    if (document.body.classList.contains("dark-mode")) {
        themeToggle.textContent = "â˜€ï¸";
        localStorage.setItem("darkMode", "enabled");
    } else {
        themeToggle.textContent = "ðŸŒ™";
        localStorage.setItem("darkMode", "disabled");
    }
});

// Initialize dark mode from storage
if (localStorage.getItem("darkMode") === "enabled") {
    document.body.classList.add("dark-mode");
    if (themeToggle) themeToggle.textContent = "â˜€ï¸";
}

// ================================
// Schedule Page - Interactive Calendar
// ================================
const liveTutoringTimes = ["Mon 3:30 PM", "Wed 3:30 PM", "Thu 3:30 PM"];
const groupTutoringTimes = ["Tue 3:00 PM", "Thu 3:00 PM"];

function createCalendarSlots(containerId, times) {
    const container = document.getElementById(containerId);
    if (!container) return;

    container.innerHTML = "";
    times.forEach(time => {
        const slot = document.createElement("div");
        slot.className = "calendar-slot";
        slot.textContent = time;

        // Check if already booked
        const booked = JSON.parse(localStorage.getItem("bookedSessions") || "[]");
        if (booked.includes(time)) slot.classList.add("booked");

        slot.addEventListener("click", () => {
            if (!slot.classList.contains("booked")) {
                slot.classList.add("booked");
                booked.push(time);
                localStorage.setItem("bookedSessions", JSON.stringify(booked));
                alert(`Session booked for ${time}! Check your Dashboard.`);
                updateDashboardBookedSessions();
            }
        });

        container.appendChild(slot);
    });
}

createCalendarSlots("calendar-live", liveTutoringTimes);
createCalendarSlots("calendar-group", groupTutoringTimes);

// ================================
// Dashboard - Show Booked Sessions
// ================================
function updateDashboardBookedSessions() {
    const booked = JSON.parse(localStorage.getItem("bookedSessions") || "[]");
    const dashboardList = document.querySelector("#dashboardBookedSessions");
    if (!dashboardList) return;

    dashboardList.innerHTML = "";
    if (booked.length === 0) {
        const li = document.createElement("li");
        li.textContent = "No sessions booked yet.";
        dashboardList.appendChild(li);
    } else {
        booked.forEach(session => {
            const li = document.createElement("li");
            li.textContent = session;
            dashboardList.appendChild(li);
        });
    }
}

// ================================
// Progress Bar Updates
// ================================
const progressBar = document.getElementById("progressBar");
let progressPoints = JSON.parse(localStorage.getItem("progressPoints") || "0");

function updateProgress(points = 1) {
    progressPoints += points;
    if (progressPoints > 100) progressPoints = 100;
    localStorage.setItem("progressPoints", JSON.stringify(progressPoints));
    if (progressBar) progressBar.style.width = progressPoints + "%";
}

// Update on load
if (progressBar) progressBar.style.width = progressPoints + "%";

// ================================
// Interactive Quiz Handling
// ================================
const quizForm = document.getElementById("quizForm");
if (quizForm) {
    quizForm.addEventListener("submit", e => {
        e.preventDefault();
        let correct = 0;
        quizForm.querySelectorAll(".quiz-question").forEach(q => {
            const selected = q.querySelector("input[type='radio']:checked");
            if (selected && selected.value === q.dataset.answer) correct++;
        });
        alert(`You scored ${correct} out of ${quizForm.querySelectorAll(".quiz-question").length}`);
        updateProgress(correct * 10); // each correct adds to progress
    });
}

// ================================
// Embedded Videos / Docs Click Tracker
// ================================
document.querySelectorAll(".track-progress").forEach(el => {
    el.addEventListener("click", () => {
        updateProgress(5); // small increment per click
    });
});

// Initialize dashboard on load
updateDashboardBookedSessions();
